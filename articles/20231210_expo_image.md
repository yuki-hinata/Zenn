---
title: "Expo Imageを使ったら画像表示速度がバク上がりした話"
emoji: "🍎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["React Native", "Expo", "Tech"]
published: false
publication_name: "manalink_dev"
---
目次
1. 背景
2. 実装と解決策
3. Expo Imageとは？
4. どれくらい早くなったのか？
5. おわりに

**※今回の測定に関しては、弊社のネットワーク速度の影響もありますので、必ずしもこれぐらいの速さになるということはありません。そちらをご了承の上お読みいただければと思います。**

## 1. 背景
弊社のアプリには、チャット機能があるのですが、そこで送られた画像はモーダルとして見て、拡大表示して見たりすることが可能です。サービスの特性上、生徒様の送った問題の写真などが多くなるので、ユーザー体験から考えると、この機能はとても重要となります。ですが、ユーザーの方から「モーダルとして画像を表示するのに時間がかかる」といったお問い合わせがありました。

## 2. 実装と解決策
弊社では、[react-native-image-zoom-viewer](https://github.com/siimorasmae/react-native-image-zoom-viewer)というライブラリを使用して、画像をモーダルとして見たり、拡大表示する機能を実現させています。
このライブラリは、下記のサンプルコードのように画像表示するコンポーネントを渡すことができるのですが、そこにExpo ImageのImageコンポーネントを渡すことで、画像表示速度が改善しました。
```tsx:Images.tsx
import { Image as ExpoImage } from 'expo-image';
import ImageViewer from 'react-native-image-zoom-viewer';

<ImageViewer
  imageUrls={props.imageUrls.map((m) => ({ url: getResizedImageForImageModal(m) }))}
  renderImage={(props) => {
    return <ExpoImage source={props.source.uri} style={props.style} />;
  }}
 />
```


## 3. Expo Imageとは？
Expo Imageは、Expo SDK 48以降に含まれているコンポーネントで、画像を表示するためのコンポーネントです。今までは、Expo Managed Workflowを使っている場合は、React NativeのImageコンポーネントを使っていました。
ですが、React NativeのImageコンポーネントには画像の表示速度が遅いという問題がありました。その点Expo Imageは、公式ドキュメントに書かれているように、Expo Imageはスピード重視の設計になっているので、その点でReact NativeのImageコンポーネントよりも優れていると言えます。


## 4. どれくらい早くなったのか？
実際に、Expo Imageを使う前と使った後の画像表示速度を計測してみました。計測方法は、人力でストップウォッチを使って朝(10:00ぐらい)、昼(13:00ぐらい)、夜(18:00ぐらい)の計3回計測しました。4Gかつ、20MB、10MB、300KBの画像を、Expo 47でReact NativeのImageコンポーネントを使っているバージョンと、Expo 48でExpo Imageを使っているバージョンでそれぞれ5回ずつ送信し、その表示速度の平均を取り、比較しました。4Gで計測している理由は、Wi-Fiの場合は、画像の表示速度が早すぎて、あまり参考にならなかったためです。
結果に関しては、長くなるため20MBのときの計測結果だけ載せます。

### Expo 47でReact NativeのImageコンポーネントを使っているバージョン
朝: (3 + 3.1 + 2.5 + 2.8 + 3) / 5 = **2.88**

昼: (3 + 2.5 + 2.5 + 2.6 + 2.3) / 5 = **2.58**

夜: (1.5 + 1.9+ 4.3 + 1.7 + 16) / 5 = **5.08**

### Expo 48でExpo Imageを使っているバージョン
朝: ( 0.6 + 0.7 + 0.6 + 0.6 + 0.6 ) / 5 = **0.62**

昼: (0.7 + 0.6 + 0.5 + 0.6 + 0.5) / 5 = **0.58**

夜: ( 0.8 + 0.7 + 0.6 + 0.6 + 0.6 ) / 5 = **0.66**

上記の結果から分かるように、Expo Imageを使うことで、画像の表示速度が大幅に改善されました。一回一回の開く速度も上がっているのはもちろんですが、表示速度にブレがないのが素晴らしいです。


## 5. おわりに
今回は、Expo Imageを使うことで、画像の表示速度が改善したという話をしました。今回の測定に関しては、弊社のネットワーク速度の影響もありますので、必ずしもこれぐらいの速さになるということはありません。そちらをご了承の上、お読みいただければと思います。

